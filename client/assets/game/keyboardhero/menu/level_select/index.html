<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/ui_elements.css">
    <style>
        .menuContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            background-image: url('/assets/game/keyboardhero/textures/game_background.png');
            background-position: center;
            background-size: cover;
        }

        .mainPageContent {
            width: 100%;
            flex: 1;
            display: flex;
            align-items: center;
            flex-direction: column;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 10px;
            text-align: center;
        }

    .backShortcut {
        position: absolute;
        top: 5px;
        left: 5px;
    }

    .backShortcut img {
        height: 40px;
        filter: invert();
        cursor: pointer;
    }

        .levelSelectContainer {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80%;
            max-width: 800px;
            height: 300px;
            margin-top: 100px;
            position: relative;
        }

        .leftArrowContainer,
        .rightArrowContainer {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arrow {
            cursor: pointer;
            font-size: 3rem;
            color: #fff;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            visibility: visible;
        }

        .arrow.hidden {
            visibility: hidden;
        }

        .songPanelContainer {
            display: flex;
            overflow: hidden;
            width: 700px;
            justify-content: center;
            transition: transform 0.5s ease;
        }
    }

        .songPanel {
            min-width: 100%;
            height: 500px;
            text-align: center;
            background-color: #333;
            color: #fff;
            padding: 10px;
            display: none;
            border-radius: 10px;
        }

        .mainPageContent {
            padding: 0px;
        }

        .songImage {
            width: 80%; /* Make the image width smaller */
            height: auto; /* Maintain aspect ratio */
            max-height: 2500px; /* Set a maximum height */
            object-fit: cover;
            border-radius: 10px;
        }

        .songInfoContainer {
            margin-top: 110px;
            width: 100%;
            max-width: 700px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            text-align: center;
            border-radius: 10px;
        }

        .songInfoText {
            margin: 0;
            font-size: 1.2rem;
        }

        .playButton {
            margin-top: 5px; /* 5px below the song info container */
            padding: 10px 20px;
            font-size: 1.2rem;
            color: #fff;
            background-color: #28a745;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .playButton:hover {
            background-color: #218838;
        }

        @media screen and (max-width: 800px) {
            .mainPageContent {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="menuContainer">
        <div class="topBar">
            <div class="backShortcut">
                <img onclick="MenuManager.GoBack();" src="/assets/game/keyboardhero/textures/button_back.png" alt="">
            </div>
        </div>

        <div class="mainPageContent">
            <!-- Scrolling Level Select Container -->
            <div class="levelSelectContainer">
                <div class="leftArrowContainer">
                    <div class="arrow leftArrow" id="leftArrow" onclick="scrollToLeft()">❮</div>
                </div>
                <div class="songPanelContainer">
                    <div class="songPanel active" id="song1">
                        <img src="/assets/game/keyboardhero/textures/song1.png" alt="Song 1" class="songImage">
                    </div>
                    <div class="submit bubbleButtons">
                        <div class="shadow">
                            <button onclick="UploadSong()">Process</button>
                        </div>
                    </div>
                    <div class="songPanel" id="song3">
                        <img src="/assets/game/keyboardhero/textures/6.jpg" alt="Song 3" class="songImage">
                    </div>
                    <!-- Add more song panels as needed -->
                </div>
                <div class="rightArrowContainer">
                    <div class="arrow rightArrow" onclick="scrollToRight()">❯</div>
                </div>
            </div>

            <!-- Song Info Container -->
            <div class="songInfoContainer">
                <p class="songInfoText" id="songName">Song 1 - Artist</p>
                <p class="songInfoText" id="songDifficulty">Difficulty: Easy</p>
            </div>
            
            <!-- Play Button -->
            <div class="playButton">
                <input type="file" id="mp3FileUpload" multiple>
                <button class="" onclick="UploadNewSong()">Upload</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            let currentSongIndex = 0;
            const songs = document.querySelectorAll('.songPanel');
            const leftArrow = document.getElementById('leftArrow');
            const songInfo = [
                { name: 'Song 1 - Artist', difficulty: 'Easy' },
                { name: 'Song 2 - Artist', difficulty: 'Medium' },
                { name: 'Song 3 - Artist', difficulty: 'Hard' }
                // Add more song info as needed
            ];
            const songNameElement = document.getElementById('songName');
            const songDifficultyElement = document.getElementById('songDifficulty');

            function showSong(index) {
                songs.forEach((song, i) => {
                    song.classList.remove('active');
                    if (i === index) {
                        song.classList.add('active');
                    }
                });
                // Update song info text
                songNameElement.textContent = songInfo[index].name;
                songDifficultyElement.textContent = `Difficulty: ${songInfo[index].difficulty}`;
                
                // Always show the left arrow (as requested)
                leftArrow.classList.remove('hidden');
            }

            window.scrollToLeft = function() {
                currentSongIndex = (currentSongIndex === 0) ? songs.length - 1 : currentSongIndex - 1;
                showSong(currentSongIndex);
            }

            window.scrollToRight = function() {
                currentSongIndex = (currentSongIndex === songs.length - 1) ? 0 : currentSongIndex + 1;
                showSong(currentSongIndex);
            }

            window.playSong = function() {
                MenuManager.GoTo(MENU_UPLOAD_SONGS); // Redirect to the level select
            }

            // Initialize the first song panel as active
            showSong(currentSongIndex);
        })();

        function UploadNewSong() {
            var fd = new FormData();

            fd.append('name', document.getElementById('mp3FileUpload').files[0].name);
            fd.append('file', document.getElementById('mp3FileUpload').files[0]);

            $.ajax({
                type: "POST",
                xhr: function () {
                    var xhr = new window.XMLHttpRequest();
                    xhr.upload.addEventListener("progress", function (evt) {
                        if (evt.lengthComputable) {
                            var percentComplete = (evt.loaded / evt.total) * 100;
                            //document.getElementById("updateProgress").style.width = percentComplete + "%";
                        }
                    }, false);
                    return xhr;
                },
                url: "/newSongUpload",
                data: fd,
                cache: false,
                contentType: false,
                processData: false,
                success: function (text) {
                    if (text.startsWith("{")) {
                        gamePASSData = text;
                        MenuManager.GoTo(MENU_SINGLEPLAYER);
                    } else {
                        alert(text.replace(/<\/[^>]+(>|$)/g, ""));
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("Can't connect to host\n" + textStatus + " - " + errorThrown);
                }
            });
        }
    </script>
</body>
</html>